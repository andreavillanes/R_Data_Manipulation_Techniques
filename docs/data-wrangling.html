<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data Wrangling | Data Manipulation Techniques with R</title>
  <meta name="description" content="Chapter 4 Data Wrangling | Data Manipulation Techniques with R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data Wrangling | Data Manipulation Techniques with R" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="andreavillanes/R_Data_Manipulation_Techniques" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data Wrangling | Data Manipulation Techniques with R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="programming-fundamentals.html"/>
<link rel="next" href="resources.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a style="font-weight:bold" href="https://andreavillanes.github.io/R_Data_Manipulation_Techniques/">Data Manipulation Techniques with R</a>
<img src="./img/iaaicon.png" alt="IAA"  class="center"</li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#getting-started"><i class="fa fa-check"></i><b>1.1</b> Getting Started</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#variable-assignment"><i class="fa fa-check"></i><b>1.2</b> Variable Assignment</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#finding-variables"><i class="fa fa-check"></i><b>1.3</b> Finding Variables</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#deleting-variables"><i class="fa fa-check"></i><b>1.4</b> Deleting Variables</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Data Structures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>2.1</b> Vectors</a></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>2.2</b> Lists</a></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#arrays"><i class="fa fa-check"></i><b>2.3</b> Arrays</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#matrices"><i class="fa fa-check"></i><b>2.4</b> Matrices</a></li>
<li class="chapter" data-level="2.5" data-path="data-structures.html"><a href="data-structures.html#data-frames"><i class="fa fa-check"></i><b>2.5</b> Data Frames</a></li>
<li class="chapter" data-level="2.6" data-path="data-structures.html"><a href="data-structures.html#working-with-different-types"><i class="fa fa-check"></i><b>2.6</b> Working with different types</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming-fundamentals.html"><a href="programming-fundamentals.html"><i class="fa fa-check"></i><b>3</b> Programming Fundamentals</a>
<ul>
<li class="chapter" data-level="3.1" data-path="programming-fundamentals.html"><a href="programming-fundamentals.html#logicals"><i class="fa fa-check"></i><b>3.1</b> Logicals</a></li>
<li class="chapter" data-level="3.2" data-path="programming-fundamentals.html"><a href="programming-fundamentals.html#conditionals"><i class="fa fa-check"></i><b>3.2</b> Conditionals</a></li>
<li class="chapter" data-level="3.3" data-path="programming-fundamentals.html"><a href="programming-fundamentals.html#loops"><i class="fa fa-check"></i><b>3.3</b> Loops</a></li>
<li class="chapter" data-level="3.4" data-path="programming-fundamentals.html"><a href="programming-fundamentals.html#functions"><i class="fa fa-check"></i><b>3.4</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>4</b> Data Wrangling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-wrangling.html"><a href="data-wrangling.html#libraries"><i class="fa fa-check"></i><b>4.1</b> Libraries</a></li>
<li class="chapter" data-level="4.2" data-path="data-wrangling.html"><a href="data-wrangling.html#importing-exporting-data"><i class="fa fa-check"></i><b>4.2</b> Importing &amp; Exporting Data</a></li>
<li class="chapter" data-level="4.3" data-path="data-wrangling.html"><a href="data-wrangling.html#dplyr-and-tidyverse"><i class="fa fa-check"></i><b>4.3</b> dplyr and tidyverse</a></li>
<li class="chapter" data-level="4.4" data-path="data-wrangling.html"><a href="data-wrangling.html#data-manipulation---dplyr-basics"><i class="fa fa-check"></i><b>4.4</b> Data manipulation - dplyr basics</a></li>
<li class="chapter" data-level="4.5" data-path="data-wrangling.html"><a href="data-wrangling.html#dplyr---pipe-operator"><i class="fa fa-check"></i><b>4.5</b> dplyr - pipe operator</a></li>
<li class="chapter" data-level="4.6" data-path="data-wrangling.html"><a href="data-wrangling.html#stringr-package"><i class="fa fa-check"></i><b>4.6</b> stringr package</a></li>
<li class="chapter" data-level="4.7" data-path="data-wrangling.html"><a href="data-wrangling.html#combining-data---dplyr"><i class="fa fa-check"></i><b>4.7</b> Combining Data - dplyr</a></li>
<li class="chapter" data-level="4.8" data-path="data-wrangling.html"><a href="data-wrangling.html#cheat-sheet"><i class="fa fa-check"></i><b>4.8</b> Cheat Sheet</a></li>
<li class="chapter" data-level="4.9" data-path="data-wrangling.html"><a href="data-wrangling.html#extra---sqldf"><i class="fa fa-check"></i><b>4.9</b> Extra - sqldf</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>5</b> Resources</a>
<ul>
<li class="chapter" data-level="5.1" data-path="resources.html"><a href="resources.html#cheat-sheets"><i class="fa fa-check"></i><b>5.1</b> Cheat Sheets</a></li>
<li class="chapter" data-level="5.2" data-path="resources.html"><a href="resources.html#programming-style"><i class="fa fa-check"></i><b>5.2</b> Programming Style</a></li>
<li class="chapter" data-level="5.3" data-path="resources.html"><a href="resources.html#other-resources"><i class="fa fa-check"></i><b>5.3</b> Other resources</a></li>
<li class="chapter" data-level="5.4" data-path="resources.html"><a href="resources.html#books"><i class="fa fa-check"></i><b>5.4</b> Books</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Manipulation Techniques with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-wrangling" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Data Wrangling</h1>
<div id="libraries" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Libraries</h2>
<p>Up until now, we haven’t used packages - only functions available in base R. However, the power of R truly exists in the libraries, which are sets of functions that any user can create and share.</p>
<p>As of June 2019, there were over 14,000 packages available on the Comprehensive R Archive Network, or CRAN, the public clearing house for R packages. CRAN lists all libraries here: <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html" class="uri">https://cran.r-project.org/web/packages/available_packages_by_name.html</a></p>
<p>To install a library, you can either:</p>
<ul>
<li>Packages <code>--&gt;</code> Install <code>--&gt;</code> Name</li>
<li>Use the function install.packages()</li>
</ul>
<p>Once a package is installed, you need to load it using the library or require function.</p>
<p>These are the libraries we’ll be using today. Install if you don’t have:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-wrangling.html#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;data.table&quot;</span>,<span class="st">&quot;dplyr&quot;</span>,<span class="st">&quot;stringr&quot;</span>))</span></code></pre></div>
<p>Now, import the libraries:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-wrangling.html#cb2-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(data.table)</span>
<span id="cb2-2"><a href="data-wrangling.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="data-wrangling.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(stringr)</span></code></pre></div>
</div>
<div id="importing-exporting-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Importing &amp; Exporting Data</h2>
<p>Before importing data, we generally want to set the working directory. This is a folder where we will be accessing or storing data and outputs:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-wrangling.html#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setwd</span>(<span class="st">&quot;C:/Users/avillan/Documents/Class 2022/Class_Code&quot;</span>)</span></code></pre></div>
<p>Another useful function is <code>getwd()</code>. This function returns an absolute filepath representing the current working directory of the R process, or <code>NULL</code> if the working directory is not available:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-wrangling.html#cb4-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getwd</span>()</span></code></pre></div>
<p>To import data, we can use the <code>read.</code> function</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-wrangling.html#cb5-1" aria-hidden="true" tabindex="-1"></a>  df_auto <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Auto_MPG.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We can check the data set:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-wrangling.html#cb6-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(df_auto)</span>
<span id="cb6-2"><a href="data-wrangling.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto)</span>
<span id="cb6-3"><a href="data-wrangling.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(df_auto)</span>
<span id="cb6-4"><a href="data-wrangling.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(df_auto)</span>
<span id="cb6-5"><a href="data-wrangling.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(df_auto)</span></code></pre></div>
<p>Note that Horsepower is a character class</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-wrangling.html#cb7-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">typeof</span>(df_auto<span class="sc">$</span>Horsepower)</span>
<span id="cb7-2"><a href="data-wrangling.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  df_auto<span class="sc">$</span>Horsepower</span>
<span id="cb7-3"><a href="data-wrangling.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(df_auto<span class="sc">$</span>Horsepower)</span></code></pre></div>
<p>Upon inspection, it read NAs as question marks (a character), so everything became a character. We can fix this by reassigning as numeric:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-wrangling.html#cb8-1" aria-hidden="true" tabindex="-1"></a>  df_auto<span class="sc">$</span>Horsepower <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_auto<span class="sc">$</span>Horsepower)</span>
<span id="cb8-2"><a href="data-wrangling.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(df_auto)</span>
<span id="cb8-3"><a href="data-wrangling.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  df_auto<span class="sc">$</span>Horsepower</span>
<span id="cb8-4"><a href="data-wrangling.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(df_auto<span class="sc">$</span>Horsepower)</span></code></pre></div>
<p>Recall if you want to fix a column name you can use the colnames() function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-wrangling.html#cb9-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)</span>
<span id="cb9-2"><a href="data-wrangling.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)[<span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Origin&quot;</span></span>
<span id="cb9-3"><a href="data-wrangling.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)</span></code></pre></div>
<p>If we want to export the data, we can use write.csv. The row.names = FALSE argument will stop the writer from outputting a row number:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-wrangling.html#cb10-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(df_auto, <span class="at">file=</span><span class="st">&quot;Auto_MPG_Clean.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>In addition to importing the data using code, one can also import data into RStudio with point-and-click. Go to <code>Import Dataset</code> in the Environment panel and select the relevant format. From there, you can set the datatype of each column, as well as specify whether to include or to skip a column or row. RStudio automatically generates the corresponding code that you can copy and paste for later reproducibility.</p>
</div>
<div id="dplyr-and-tidyverse" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> dplyr and tidyverse</h2>
<p>One of the most difficult (yet, interesting!) parts of open-source software is the many ways to achieve the same task. This can make recalling functions and syntax difficult, increasing the time to write or read code. Thus, people have started creating packages that structure coding tasks into a simple but comprehensive set of functions. You’ll see this referred to as a “grammar”. This framework attempts to simplify the majority of required functions into a simple set of “verbs” to remember.</p>
<p>If you’re familiar with SQL - think about how easy it is to read and write:</p>
<p><code>SELECT * FROM table WHERE column = 'some_value'</code></p>
<p>In SQL, <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code> are “verbs” that provide the framework for numerous tasks.</p>
<p>The packages plyr, dplyr, ggplot2, stringr (and others) work within this framework. “tidyverse” is a collection of packages that encompases all of these <a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a></p>
</div>
<div id="data-manipulation---dplyr-basics" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Data manipulation - dplyr basics</h2>
<p>Select: select columns by name or helper function (choose which variables you want to look at ):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-wrangling.html#cb11-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(df_auto, MPG, Cylinders)</span>
<span id="cb11-2"><a href="data-wrangling.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(df_auto, <span class="sc">-</span>Origin)</span>
<span id="cb11-3"><a href="data-wrangling.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(df_auto, <span class="fu">contains</span>(<span class="st">&quot;Model&quot;</span>))</span></code></pre></div>
<p>The base R equivalents are:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-wrangling.html#cb12-1" aria-hidden="true" tabindex="-1"></a>  df_auto<span class="sc">$</span>MPG</span>
<span id="cb12-2"><a href="data-wrangling.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  df_auto[,<span class="fu">c</span>(<span class="st">&#39;MPG&#39;</span>,<span class="st">&#39;Cylinders&#39;</span>)]</span>
<span id="cb12-3"><a href="data-wrangling.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  df_auto[,<span class="sc">-</span><span class="fu">c</span>(<span class="st">&#39;Origin&#39;</span>)]</span>
<span id="cb12-4"><a href="data-wrangling.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  df_auto[,<span class="fu">grepl</span>(<span class="st">&quot;Model&quot;</span>, <span class="fu">names</span>(df_auto))] </span></code></pre></div>
<p>Slice: Select rows by position (choose which rows of data you want):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-wrangling.html#cb13-1" aria-hidden="true" tabindex="-1"></a>  df_auto<span class="sc">$</span>row_number <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_auto) <span class="co">#adding a new variable called row_number to help us see the index </span></span>
<span id="cb13-2"><a href="data-wrangling.html#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="data-wrangling.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(df_auto,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb13-4"><a href="data-wrangling.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(df_auto, <span class="dv">150</span><span class="sc">:</span><span class="fu">n</span>()) <span class="co">#all the rows between 150 and the end</span></span>
<span id="cb13-5"><a href="data-wrangling.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(df_auto, <span class="sc">-</span><span class="dv">1</span><span class="sc">:-</span><span class="dv">5</span>) <span class="co">#removes rows between values, equivalent to slice(df_auto, 6:n())</span></span>
<span id="cb13-6"><a href="data-wrangling.html#cb13-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-7"><a href="data-wrangling.html#cb13-7" aria-hidden="true" tabindex="-1"></a>  df_auto <span class="ot">&lt;-</span> <span class="fu">select</span>(df_auto, <span class="sc">-</span>row_number) <span class="co">#remove the row_number column</span></span></code></pre></div>
<p>The base R equivalents are:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-wrangling.html#cb14-1" aria-hidden="true" tabindex="-1"></a>  df_auto[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb14-2"><a href="data-wrangling.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  df_auto[<span class="dv">150</span><span class="sc">:</span><span class="fu">nrow</span>(df_auto),]</span>
<span id="cb14-3"><a href="data-wrangling.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  df_auto[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),]</span></code></pre></div>
<p>Rename: Rename the columns of a data frame</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-wrangling.html#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)</span>
<span id="cb15-2"><a href="data-wrangling.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="data-wrangling.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  df_auto <span class="ot">&lt;-</span> <span class="fu">rename</span>(df_auto, <span class="at">Miles_Per_Gallon=</span>MPG) <span class="co">#rename MPG to Miles_Per_Gallon</span></span>
<span id="cb15-4"><a href="data-wrangling.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)</span>
<span id="cb15-5"><a href="data-wrangling.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-6"><a href="data-wrangling.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  df_auto <span class="ot">&lt;-</span> <span class="fu">rename</span>(df_auto, <span class="at">MPG=</span>Miles_Per_Gallon) <span class="co">#rename back Miles_Per_Gallon to MPG</span></span>
<span id="cb15-7"><a href="data-wrangling.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)</span></code></pre></div>
<p>The base R equivalents are:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-wrangling.html#cb16-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;Miles_Per_Gallon&#39;</span></span>
<span id="cb16-2"><a href="data-wrangling.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)</span>
<span id="cb16-3"><a href="data-wrangling.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4"><a href="data-wrangling.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;MPG&#39;</span></span>
<span id="cb16-5"><a href="data-wrangling.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df_auto)</span></code></pre></div>
<p>Filter: Extract rows that meet logical criteria (filter the data frame by one, or multiple, conditions)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-wrangling.html#cb17-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(df_auto, MPG<span class="sc">&gt;</span><span class="dv">20</span>)</span>
<span id="cb17-2"><a href="data-wrangling.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(df_auto, (MPG<span class="sc">&gt;</span><span class="dv">20</span> <span class="sc">&amp;</span> Acceleration<span class="sc">&gt;</span><span class="dv">20</span>))</span>
<span id="cb17-3"><a href="data-wrangling.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(df_auto, MPG<span class="sc">==</span><span class="fu">max</span>(MPG))</span>
<span id="cb17-4"><a href="data-wrangling.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(df_auto, MPG<span class="sc">==</span><span class="fu">min</span>(MPG))</span></code></pre></div>
<p>The base R equivalents are:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-wrangling.html#cb18-1" aria-hidden="true" tabindex="-1"></a>  df_auto[df_auto<span class="sc">$</span>MPG<span class="sc">&gt;</span><span class="dv">20</span>,]</span>
<span id="cb18-2"><a href="data-wrangling.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  df_auto[(df_auto<span class="sc">$</span>MPG<span class="sc">&gt;</span><span class="dv">20</span> <span class="sc">&amp;</span> df_auto<span class="sc">$</span>Acceleration<span class="sc">&gt;</span><span class="dv">20</span>),]</span>
<span id="cb18-3"><a href="data-wrangling.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  df_auto[<span class="fu">which.max</span>(df_auto<span class="sc">$</span>MPG),]</span>
<span id="cb18-4"><a href="data-wrangling.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  df_auto[<span class="fu">which.min</span>(df_auto<span class="sc">$</span>MPG),]</span></code></pre></div>
<p>Sample: Randomly select a sample of n size or a proportion</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-wrangling.html#cb19-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(df_auto, <span class="dv">5</span>)</span>
<span id="cb19-2"><a href="data-wrangling.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(df_auto, <span class="fl">0.05</span>)</span></code></pre></div>
<p>The base R equivalents are:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-wrangling.html#cb20-1" aria-hidden="true" tabindex="-1"></a>  df_auto[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_auto),<span class="dv">5</span>),]</span>
<span id="cb20-2"><a href="data-wrangling.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  df_auto[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_auto),<span class="fu">ceiling</span>(<span class="fl">0.05</span><span class="sc">*</span><span class="fu">nrow</span>(df_auto))),]</span></code></pre></div>
<p>Mutate: Compute and append one or more new columns (create a new variable - returns the data frame)</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-wrangling.html#cb21-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(df_auto, <span class="at">HP_Per_Cylinder=</span>Horsepower<span class="sc">/</span>Cylinders)</span>
<span id="cb21-2"><a href="data-wrangling.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(df_auto, <span class="at">Avg_HP_Per_Cylinder =</span> <span class="fu">mean</span>(Horsepower<span class="sc">/</span>Cylinders, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<p>The base R equivalents are:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-wrangling.html#cb22-1" aria-hidden="true" tabindex="-1"></a>  df_auto<span class="sc">$</span>HP_Per_Cylinder <span class="ot">&lt;-</span> df_auto<span class="sc">$</span>Horsepower <span class="sc">/</span> df_auto<span class="sc">$</span>Cylinders</span>
<span id="cb22-2"><a href="data-wrangling.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  df_auto<span class="sc">$</span>Avg_HP_Per_Cylinder <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_auto<span class="sc">$</span>Horsepower <span class="sc">/</span> df_auto<span class="sc">$</span>Cylinders, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>About the na.rm=TRUE argument. Some arithmatic functions sum, avg, count, etc. will NA the entire column if they encounter a single NA within that column/vector. Setting na.rm=TRUE will tell the interpreter to “remove” the NA and carry forth with the calculation.</p>
<p>Summarise: Summarise data into single row of values (aggregates the data into a single result. think avg, mean, min, max, etc.)</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-wrangling.html#cb23-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(df_auto, </span>
<span id="cb23-2"><a href="data-wrangling.html#cb23-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">Avg_HP_Per_Cylinder=</span><span class="fu">mean</span>(Horsepower<span class="sc">/</span>Cylinders, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb23-3"><a href="data-wrangling.html#cb23-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">Min_HP_Per_Cylinder=</span><span class="fu">min</span>(Horsepower<span class="sc">/</span>Cylinders, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-4"><a href="data-wrangling.html#cb23-4" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
<p>The base R equivalents are:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-wrangling.html#cb24-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb24-2"><a href="data-wrangling.html#cb24-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">Avg_HP_Per_Cylinder =</span> <span class="fu">mean</span>(df_auto<span class="sc">$</span>Horsepower<span class="sc">/</span>df_auto<span class="sc">$</span>Cylinders, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-3"><a href="data-wrangling.html#cb24-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_HP_Per_Cylinder =</span> <span class="fu">min</span>(df_auto<span class="sc">$</span>Horsepower<span class="sc">/</span>df_auto<span class="sc">$</span>Cylinders, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-4"><a href="data-wrangling.html#cb24-4" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<div id="dplyr---pipe-operator" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> dplyr - pipe operator</h2>
<p>Consider the previous operations. If we wanted to manipulate our data set in order, we traditionally have to do a reassignment each time:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-wrangling.html#cb25-1" aria-hidden="true" tabindex="-1"></a>  ddf_auto_hold <span class="ot">&lt;-</span> <span class="fu">rename</span>(df_auto, <span class="at">Miles_Per_Gallon=</span>MPG) <span class="co">#rename</span></span>
<span id="cb25-2"><a href="data-wrangling.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-3"><a href="data-wrangling.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df_auto_hold, <span class="at">HP_Per_Cylinder=</span>Horsepower<span class="sc">/</span>Cylinders) <span class="co">#then create</span></span>
<span id="cb25-4"><a href="data-wrangling.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-5"><a href="data-wrangling.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> <span class="fu">filter</span>(df_auto_hold, HP_Per_Cylinder<span class="sc">&gt;</span><span class="dv">20</span>) <span class="co">#then filter</span></span>
<span id="cb25-6"><a href="data-wrangling.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-7"><a href="data-wrangling.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> <span class="fu">select</span>(df_auto_hold, Car_Name, HP_Per_Cylinder) <span class="co">#then select</span></span>
<span id="cb25-8"><a href="data-wrangling.html#cb25-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-9"><a href="data-wrangling.html#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
<p>This is truely cumbersome the more complicated the data manipulation becomes. To avoid this, we can use the pipe operator <code>%&gt;%</code>. The pipe “passes along” the results of one function to the next:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-wrangling.html#cb26-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span> <span class="co">#note the pipe operator </span></span>
<span id="cb26-2"><a href="data-wrangling.html#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Miles_Per_Gallon=</span>MPG) <span class="sc">%&gt;%</span> <span class="co">#note the first argument is not required, because the pipe is passing it </span></span>
<span id="cb26-3"><a href="data-wrangling.html#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">HP_Per_Cylinder=</span>Horsepower<span class="sc">/</span>Cylinders) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="data-wrangling.html#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(HP_Per_Cylinder<span class="sc">&gt;</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="data-wrangling.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Car_Name, HP_Per_Cylinder)</span>
<span id="cb26-6"><a href="data-wrangling.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-7"><a href="data-wrangling.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
</div>
<div id="stringr-package" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> stringr package</h2>
<p>The package stringr is a similar grammar language for manipulating strings. All the functions start with str_</p>
<p>Consider that I want to extract the Car Make and Model from the Car Name:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-wrangling.html#cb27-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
<p>We note that the first word in Car_Name is the make, and the second word is the model. The str_split function will split the string into a vector of individual tokens:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-wrangling.html#cb28-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="data-wrangling.html#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Car_Make=</span><span class="fu">str_split</span>(Car_Name,<span class="st">&quot; &quot;</span>))</span>
<span id="cb28-3"><a href="data-wrangling.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-4"><a href="data-wrangling.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
<p>The str_split creates a list, which we can use to try to get the value:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-wrangling.html#cb29-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="data-wrangling.html#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Car_Make=</span><span class="fu">str_split</span>(Car_Name,<span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb29-3"><a href="data-wrangling.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
<p>Note, this is treating the entire column, instead of by row. One way to address this is to rowise() by Car_Name, then create the variable:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-wrangling.html#cb30-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="data-wrangling.html#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="data-wrangling.html#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Car_Make=</span><span class="fu">str_split</span>(Car_Name,<span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb30-4"><a href="data-wrangling.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-5"><a href="data-wrangling.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
<p>An alternative to this group_by is the group_by() function:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-wrangling.html#cb31-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="data-wrangling.html#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Car_Name) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="data-wrangling.html#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Car_Make=</span><span class="fu">str_split</span>(Car_Name,<span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb31-4"><a href="data-wrangling.html#cb31-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-5"><a href="data-wrangling.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
<p>With the structure built, I can just pipe on more functions to get additional variables:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-wrangling.html#cb32-1" aria-hidden="true" tabindex="-1"></a>  df_auto <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="data-wrangling.html#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="data-wrangling.html#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Car_Make=</span><span class="fu">str_split</span>(Car_Name,<span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="data-wrangling.html#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Car_Model=</span><span class="fu">paste</span>(<span class="fu">str_split</span>(Car_Name,<span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="sc">-</span><span class="dv">1</span>], <span class="at">collapse=</span><span class="st">&quot; &quot;</span>)) <span class="co">#everything but the first </span></span>
<span id="cb32-5"><a href="data-wrangling.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-6"><a href="data-wrangling.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto)</span></code></pre></div>
<p>Now that we have Car Make and Model, we might want to summarize some information. We saw summarize the entire column earlier, but we can additionally summarize by a group. We use the group_by() to do so:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-wrangling.html#cb33-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average MPG by Make and Model Year</span></span>
<span id="cb33-2"><a href="data-wrangling.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  df_auto <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="data-wrangling.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Car_Make, Model_Year) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="data-wrangling.html#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Average_MPG=</span><span class="fu">mean</span>(MPG)) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="data-wrangling.html#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Model_Year) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="data-wrangling.html#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Model_Year<span class="sc">==</span><span class="dv">70</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="data-wrangling.html#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>(Car_Make, Model_Year)</span></code></pre></div>
<p>What if we want to create a variable for each Make that is the average MPG across the Make, by year?</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-wrangling.html#cb34-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="data-wrangling.html#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Car_Make, Model_Year) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="data-wrangling.html#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Average_MPG=</span><span class="fu">mean</span>(MPG)) <span class="sc">%&gt;%</span> <span class="co">#create a column that contains the avg MPG for the model year of the car</span></span>
<span id="cb34-4"><a href="data-wrangling.html#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">MPG_Fold_Pct=</span><span class="fu">round</span>(((MPG<span class="sc">-</span>Average_MPG)<span class="sc">/</span>Average_MPG)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="data-wrangling.html#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>(Car_Make, Model_Year) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="data-wrangling.html#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Car_Make, Model_Year) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="data-wrangling.html#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Car_Make, Model_Year, Car_Name, MPG, Average_MPG, MPG_Fold_Pct)</span>
<span id="cb34-8"><a href="data-wrangling.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-9"><a href="data-wrangling.html#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
</div>
<div id="combining-data---dplyr" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Combining Data - dplyr</h2>
<p>Typically when working with data, especially relational databases, we have information stored in multiple tables. For instance, we have the Auto data set:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-wrangling.html#cb35-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto)</span>
<span id="cb35-2"><a href="data-wrangling.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-3"><a href="data-wrangling.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># But we also have data on when a brand started:</span></span>
<span id="cb35-4"><a href="data-wrangling.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  Car_Make <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;amc&quot;</span>, <span class="st">&quot;audi&quot;</span>, <span class="st">&quot;bmw&quot;</span>, <span class="st">&quot;buick&quot;</span>, <span class="st">&quot;chevrolet&quot;</span>, <span class="st">&quot;datsun&quot;</span>, <span class="st">&quot;dodge&quot;</span>, <span class="st">&quot;ford&quot;</span>)</span>
<span id="cb35-5"><a href="data-wrangling.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  First_Year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1954</span>, <span class="dv">1910</span>, <span class="dv">1916</span>, <span class="dv">1903</span>, <span class="dv">1911</span>, <span class="dv">1931</span>, <span class="dv">1900</span>, <span class="dv">1903</span>)</span>
<span id="cb35-6"><a href="data-wrangling.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-7"><a href="data-wrangling.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  df_auto_start <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Car_Make=</span>Car_Make, </span>
<span id="cb35-8"><a href="data-wrangling.html#cb35-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">First_Year=</span>First_Year, </span>
<span id="cb35-9"><a href="data-wrangling.html#cb35-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-10"><a href="data-wrangling.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-11"><a href="data-wrangling.html#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_start)</span></code></pre></div>
<p>We are interested in the relationship between founding year and average MPG for the max year. For this, we need to get my First Year data combined with the Auto MPG Data. This is accomplished via joins.</p>
<p>Dplyr has different join types. The easiest way to think about this is as a Venn-Diagram.</p>
<ul>
<li>inner_join - only returns the data where both frames contain the join key(s), removes all non-matching rows</li>
<li>left_join - maintains all of the data on base table (left/top), and joins matching data from the joining table. NAs created for joining table</li>
<li>right_join - opposite of left. Maintains all of the data on the joining table and matches from the base table. NAs created for base table</li>
<li>full_join - returns all data from both tables. NAs created for both tables.</li>
</ul>
<p>Inner_join:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="data-wrangling.html#cb36-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="data-wrangling.html#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(df_auto_start, <span class="at">by=</span><span class="st">&quot;Car_Make&quot;</span>)</span>
<span id="cb36-3"><a href="data-wrangling.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-4"><a href="data-wrangling.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span>
<span id="cb36-5"><a href="data-wrangling.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-6"><a href="data-wrangling.html#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note, we&#39;ve effectively filtered a lot of data because the inner_join only keeps matching records. </span></span>
<span id="cb36-7"><a href="data-wrangling.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(df_auto)</span>
<span id="cb36-8"><a href="data-wrangling.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(df_auto_hold)</span>
<span id="cb36-9"><a href="data-wrangling.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-10"><a href="data-wrangling.html#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Joins can pipe together with other functions just as we expect</span></span>
<span id="cb36-11"><a href="data-wrangling.html#cb36-11" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="data-wrangling.html#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(df_auto_start, <span class="at">by=</span><span class="st">&quot;Car_Make&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="data-wrangling.html#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Car_Make, First_Year) <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="data-wrangling.html#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Average_MPG=</span><span class="fu">mean</span>(MPG))</span>
<span id="cb36-15"><a href="data-wrangling.html#cb36-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-16"><a href="data-wrangling.html#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span>
<span id="cb36-17"><a href="data-wrangling.html#cb36-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-18"><a href="data-wrangling.html#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(df_auto_hold<span class="sc">$</span>First_Year, df_auto_hold<span class="sc">$</span>Average_MPG)</span></code></pre></div>
<p>Left_join:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="data-wrangling.html#cb37-1" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="data-wrangling.html#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_auto_start, <span class="at">by=</span><span class="st">&quot;Car_Make&quot;</span>)</span>
<span id="cb37-3"><a href="data-wrangling.html#cb37-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-4"><a href="data-wrangling.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note, we&#39;ve retained all of the records but it&#39;s placed &quot;NA&quot; in the column where it couldn&#39;t find a matching record</span></span>
<span id="cb37-5"><a href="data-wrangling.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(df_auto) </span>
<span id="cb37-6"><a href="data-wrangling.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(df_auto_hold) </span>
<span id="cb37-7"><a href="data-wrangling.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-8"><a href="data-wrangling.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(df_auto_hold<span class="sc">$</span>First_Year)</span>
<span id="cb37-9"><a href="data-wrangling.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-10"><a href="data-wrangling.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)  </span>
<span id="cb37-11"><a href="data-wrangling.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-12"><a href="data-wrangling.html#cb37-12" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> df_auto <span class="sc">%&gt;%</span></span>
<span id="cb37-13"><a href="data-wrangling.html#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_auto_start, <span class="at">by=</span><span class="st">&quot;Car_Make&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-14"><a href="data-wrangling.html#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Car_Make, First_Year) <span class="sc">%&gt;%</span></span>
<span id="cb37-15"><a href="data-wrangling.html#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Average_MPG=</span><span class="fu">mean</span>(MPG))</span>
<span id="cb37-16"><a href="data-wrangling.html#cb37-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-17"><a href="data-wrangling.html#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)  </span></code></pre></div>
</div>
<div id="cheat-sheet" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Cheat Sheet</h2>
<p>We’re not going to cover every function here, but what is great about these packages is the the cheatsheets. The community has made to provide reference. I highly recommend downloading them and keeping them close:</p>
<ul>
<li><p>dplyr: <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a></p></li>
<li><p>stringr: <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/master/strings.pdf</a></p></li>
<li><p>a whole lot more… <a href="https://www.rstudio.com/resources/cheatsheets/" class="uri">https://www.rstudio.com/resources/cheatsheets/</a></p></li>
</ul>
</div>
<div id="extra---sqldf" class="section level2" number="4.9">
<h2><span class="header-section-number">4.9</span> Extra - sqldf</h2>
<p>If you like SQL, there is a package allows you to manipulate data in a in-memory, or permanent database:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="data-wrangling.html#cb38-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;sqldf&quot;</span>)</span>
<span id="cb38-2"><a href="data-wrangling.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(sqldf)</span>
<span id="cb38-3"><a href="data-wrangling.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-4"><a href="data-wrangling.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  df_auto_hold <span class="ot">&lt;-</span> <span class="fu">sqldf</span>(<span class="st">&quot;select * from df_auto where Car_Make=&#39;amc&#39;&quot;</span>)</span>
<span id="cb38-5"><a href="data-wrangling.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(df_auto_hold)</span></code></pre></div>
<p>We will learn a lot more about SQL in the Fall semester.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="programming-fundamentals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="resources.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/andreavillanes/R_Data_Manipulation_Techniques/edit/master/04-data_wrangling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/andreavillanes/R_Data_Manipulation_Techniques/blob/master/04-data_wrangling.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
